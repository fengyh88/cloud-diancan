<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fish.cloud.repo.ProdCollectionMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.fish.cloud.bean.model.ProdCollection">
		<id column="collection_id" property="collectionId" />
		<result column="user_id" property="userId" />
		<result column="shop_id" property="shopId" />
		<result column="prod_id" property="prodId" />
		<result column="create_time" property="createTime" />
	</resultMap>


	<resultMap id="prodCollectionDtoMap" type="com.fish.cloud.bean.dto.ProdCollectionDto">
		<result column="collection_id" property="collectionId" />
		<result column="shop_id" property="shopId" />
		<result column="user_id" property="userId" />
		<result column="prod_id" property="prodId" />
		<result column="create_time" property="createTime" />
		<!--店铺-->
		<result column="shop_name" property="shopName" />
		<!--商品-->
		<result column="prod_code" property="prodCode" />
		<result column="prod_name" property="prodName" />
		<result column="pinyin" property="pinyin" />
		<result column="cate_id" property="cateId" />
		<result column="brand_id" property="brandId" />
		<result column="ori_price" property="oriPrice" />
		<result column="price" property="price" />
		<result column="mem_price" property="memPrice" />
		<result column="unit_id" property="unitId" />
		<result column="unit_name" property="unitName" />
		<result column="brief" property="brief" />
		<result column="sold" property="sold" />
		<result column="stock" property="stock" />
		<result column="status" property="status" />
		<result column="img" property="img" />
		<result column="sku_enabled" property="skuEnabled"></result>
	</resultMap>

	<sql id="prodCollectionDto_SQL">
 		c.`collection_id`,
        c.`shop_id`,
        c.`user_id`,
        c.`prod_id`,
        c.`create_time`,
        s.`shop_name`,
        p.`prod_code`,
        p.`prod_name`,
        p.`pinyin`,
        p.`cate_id`,
        p.`brand_id`,
        p.`ori_price`,
        p.`price`,
        p.`mem_price`,
        p.`unit_id`,
        p.`brief`,
        p.`sold`,
        p.`stock`,
        p.`img`,
        p.`sku_enabled`,
        p.`status`,
        kv.`value` as `unit_name`
    </sql>

	<!--全部	-->
	<select id="all" resultMap="prodCollectionDtoMap">
		SELECT
		<include refid="prodCollectionDto_SQL"/>
		FROM cloud_prod_collection c
		LEFT JOIN  cloud_shop s ON c.shop_id = s.`shop_id`
		LEFT JOIN  cloud_prod p ON c.prod_id = p.`prod_id`
		LEFT JOIN cloud_sys_dic_kv kv ON p.`unit_id` = kv.`key` AND kv.`dic_code` = 'D0001'
		WHERE  c.`user_id` = #{userId}
		<if test="shopId != null and shopId!=0 ">
			AND c.`shop_id` = #{shopId}
		</if>

	</select>


</mapper>
