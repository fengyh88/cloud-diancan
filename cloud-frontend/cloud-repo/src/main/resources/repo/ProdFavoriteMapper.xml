<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fish.cloud.repo.ProdFavoriteMapper">

	<!-- 通用查询映射结果 -->
	<resultMap id="BaseResultMap" type="com.fish.cloud.bean.model.ProdFavorite">
		<id column="favorite_id" property="favoriteId" />
		<result column="user_id" property="userId" />
		<result column="shop_id" property="shopId" />
		<result column="prod_id" property="prodId" />
		<result column="create_time" property="createTime" />
	</resultMap>

	<resultMap id="prodFavoriteDtoMap" type="com.fish.cloud.bean.dto.ProdFavoriteDto">
		<result column="favorite_id" property="favoriteId" />
		<result column="shop_id" property="shopId" />
		<result column="user_id" property="userId" />
		<result column="prod_id" property="prodId" />
		<result column="create_time" property="createTime" />
		<!--店铺-->
		<result column="shop_name" property="shopName" />
		<!--商品-->
		<result column="prod_code" property="prodCode" />
		<result column="prod_name" property="prodName" />
		<result column="pinyin" property="pinyin" />
		<result column="cate_id" property="cateId" />
		<result column="brand_id" property="brandId" />
		<result column="ori_price" property="oriPrice" />
		<result column="price" property="price" />
		<result column="mem_price" property="memPrice" />
		<result column="unit_id" property="unitId" />
		<result column="unit_name" property="unitName" />
		<result column="brief" property="brief" />
		<result column="sold" property="sold" />
		<result column="stock" property="stock" />
		<result column="status" property="status" />
		<result column="img" property="img" />
		<result column="sku_enabled" property="skuEnabled"></result>
	</resultMap>

	<sql id="prodFavoriteDto_SQL">
 		f.`favorite_id`,
        f.`shop_id`,
        f.`user_id`,
        f.`prod_id`,
        f.`create_time`,
        s.`shop_name`,
        p.`prod_code`,
        p.`prod_name`,
        p.`pinyin`,
        p.`cate_id`,
        p.`brand_id`,
        p.`ori_price`,
        p.`price`,
        p.`mem_price`,
        p.`unit_id`,
        p.`brief`,
        p.`sold`,
        p.`stock`,
        p.`img`,
        p.`sku_enabled`,
        p.`status`,
        kv.`value` as `unit_name`
    </sql>

	<!--全部	-->
	<select id="all" resultMap="prodFavoriteDtoMap">
		SELECT
		<include refid="prodFavoriteDto_SQL"/>
		FROM cloud_prod_favorite f
		LEFT JOIN  cloud_shop s ON f.shop_id = s.`shop_id`
		LEFT JOIN  cloud_prod p ON f.prod_id = p.`prod_id`
		LEFT JOIN cloud_sys_dic_kv kv ON p.`unit_id` = kv.`key` AND kv.`dic_code` = 'D0001'
		WHERE  f.`user_id` = #{userId}
		<if test="shopId != null and shopId!=0 ">
			AND f.`shop_id` = #{shopId}
		</if>

	</select>

</mapper>
